<?php
require_once 'templates/layout/header.phtml';

// si existe $seller es porque se estÃ¡ viendo el perfil de un vendedor
if ($seller)
  require_once 'templates/seller-card.phtml';
?>

<div class="container my-5">
  <h2 class="mb-4 text-center">ğŸ“¦ Lista de Ventas</h2>


  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Producto</th>
          <th>Precio</th>
          <th>Vendedor</th>
          <?php if (isset($_SESSION['USER_ROLE']) && $_SESSION['USER_ROLE'] === 'administrador'): ?>
            <th>Editar</th>
            <th>Eliminar</th>
          <?php endif; ?>
        </tr>
      </thead>
      <tbody>
        <?php if (!empty($sales)): ?>
          <?php foreach ($sales as $index => $sale): ?>
            <tr>
              <td><?= $index + 1 ?></td>
              <td>
                <a href="<?= BASE_URL ?>detalleVenta/<?= $sale->id_venta ?>" class="text-decoration-none text-reset">
                  <?= htmlspecialchars($sale->producto) ?>
                </a>
              </td>

              <td>$<?= number_format($sale->precio, 2, ',', '.') ?></td>

              <?php if ($seller): ?>
                <td><?= htmlspecialchars($seller->nombre); ?></td>
              <?php else: ?>
                <td><?= htmlspecialchars($sale->vendedor) ?></td>
              <?php endif; ?>

              <?php if (isset($_SESSION['USER_ROLE']) && $_SESSION['USER_ROLE'] === 'administrador'): ?>
                <td>
                  <a href="<?= BASE_URL ?>editarVenta/<?= $sale->id_venta ?>" class="btn btn-warning btn-sm">Editar</a>
                </td>
                <td>
                  <form action="deleteSale/<?= $sale->id_venta ?>" method="POST" class="d-inline">
                    <input type="hidden" name="id" value="<?= $sale->id_venta ?>">
                    <button type="submit" class="btn btn-danger btn-sm"
                      onclick="return confirm('Â¿Seguro que querÃ©s eliminar esta venta?');">
                      Eliminar
                    </button>
                  </form>
                </td>
              <?php endif; ?>
            </tr>
          <?php endforeach; ?>
        <?php else: ?>
          <tr>
            <td colspan="4" class="text-muted">No hay ventas disponibles.</td>
          </tr>
        <?php endif; ?>
      </tbody>
    </table>
  </div>
</div>

<?php require_once 'templates/layout/footer.phtml'; ?>
